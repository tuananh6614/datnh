<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luong Hoat Dong Phan Cung - Smart Parking</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #fff;
            padding: 20px;
        }
        .page {
            max-width: 1200px;
            margin: 0 auto;
        }
        .title {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            color: #0066cc;
            margin-bottom: 5px;
        }
        .subtitle {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-bottom: 25px;
        }
        .section-title {
            background: linear-gradient(135deg, #0066cc, #0099ff);
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 8px;
            margin: 25px 0 15px 0;
            display: inline-block;
        }
        .flow-container {
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            background: #fafafa;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="page">
        <div class="title">LUONG HOAT DONG PHAN CUNG</div>
        <div class="subtitle">Hardware Flow Diagram - Smart Parking System</div>

        <!-- ==================== LUỒNG 1: XE VÀO ==================== -->
        <div class="section-title">1. Luong Xe Vao (Entry Flow)</div>
        <div class="flow-container">
            <svg width="100%" height="500" viewBox="0 0 1100 500">
                <defs>
                    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
                    </marker>
                    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#2E7D32"/>
                    </marker>
                    <marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#1565C0"/>
                    </marker>
                    <marker id="arrow-purple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#7B1FA2"/>
                    </marker>
                </defs>

                <!-- Hàng 1: Thiết bị phần cứng -->
                <g transform="translate(20, 20)">
                    <!-- Xe -->
                    <rect x="0" y="30" width="80" height="50" rx="5" fill="#FFE082" stroke="#F57C00" stroke-width="2"/>
                    <text x="40" y="60" text-anchor="middle" font-size="12" font-weight="bold">XE VAO</text>

                    <!-- Arrow -->
                    <line x1="80" y1="55" x2="120" y2="55" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

                    <!-- Camera -->
                    <rect x="130" y="20" width="100" height="70" rx="5" fill="#333" stroke="#222" stroke-width="2"/>
                    <circle cx="180" cy="50" r="20" fill="#1a1a1a" stroke="#444" stroke-width="2"/>
                    <circle cx="180" cy="50" r="10" fill="#2196F3"/>
                    <text x="180" y="80" text-anchor="middle" font-size="9" fill="#fff">CAMERA #1</text>

                    <!-- Arrow USB -->
                    <line x1="230" y1="55" x2="280" y2="55" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>
                    <text x="255" y="48" text-anchor="middle" font-size="8" fill="#666">USB</text>

                    <!-- Desktop -->
                    <rect x="290" y="10" width="140" height="90" rx="5" fill="#2d5a8c" stroke="#1a3a5c" stroke-width="2"/>
                    <text x="360" y="35" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">DESKTOP</text>
                    <rect x="300" y="45" width="55" height="25" rx="3" fill="#FF5722"/>
                    <text x="327" y="62" text-anchor="middle" font-size="8" fill="#fff">YOLOv8</text>
                    <rect x="360" y="45" width="60" height="25" rx="3" fill="#FF5722"/>
                    <text x="390" y="62" text-anchor="middle" font-size="8" fill="#fff">EasyOCR</text>
                    <text x="360" y="88" text-anchor="middle" font-size="9" fill="#B3E5FC">Nhan dien bien so</text>

                    <!-- RFID Reader -->
                    <rect x="130" y="130" width="100" height="60" rx="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                    <circle cx="180" cy="155" r="15" fill="none" stroke="#FFC107" stroke-width="3"/>
                    <circle cx="180" cy="155" r="7" fill="#FFC107"/>
                    <text x="180" y="182" text-anchor="middle" font-size="9" fill="#fff">RFID RC522 #1</text>

                    <!-- Thẻ RFID -->
                    <rect x="20" y="140" width="60" height="40" rx="5" fill="#fff" stroke="#1565C0" stroke-width="2"/>
                    <text x="50" y="158" text-anchor="middle" font-size="8" fill="#1565C0">THE RFID</text>
                    <text x="50" y="172" text-anchor="middle" font-size="7" fill="#666">UID: xxxx</text>

                    <!-- Arrow thẻ -> RFID -->
                    <line x1="80" y1="160" x2="130" y2="160" stroke="#1565C0" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrow-blue)"/>
                    <text x="105" y="152" text-anchor="middle" font-size="7" fill="#1565C0">Quet</text>

                    <!-- ESP32 -->
                    <rect x="290" y="125" width="140" height="70" rx="5" fill="#1B5E20" stroke="#0D3610" stroke-width="2"/>
                    <text x="360" y="150" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">ESP32-S3 #1</text>
                    <text x="360" y="168" text-anchor="middle" font-size="9" fill="#AED581">Doc UID the</text>
                    <text x="360" y="183" text-anchor="middle" font-size="9" fill="#AED581">Gui MQTT</text>

                    <!-- Arrow RFID -> ESP32 -->
                    <line x1="230" y1="160" x2="290" y2="160" stroke="#1565C0" stroke-width="2" marker-end="url(#arrow-blue)"/>
                    <text x="260" y="152" text-anchor="middle" font-size="8" fill="#1565C0">SPI</text>

                    <!-- Server -->
                    <rect x="500" y="50" width="150" height="140" rx="5" fill="#37474F" stroke="#263238" stroke-width="2"/>
                    <text x="575" y="75" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">LINUX SERVER</text>

                    <rect x="510" y="85" width="130" height="35" rx="3" fill="#9C27B0"/>
                    <text x="575" y="107" text-anchor="middle" font-size="10" fill="#fff">MQTT Broker</text>

                    <rect x="510" y="125" width="130" height="35" rx="3" fill="#336791"/>
                    <text x="575" y="147" text-anchor="middle" font-size="10" fill="#fff">PostgreSQL</text>
                    <text x="575" y="178" text-anchor="middle" font-size="8" fill="#B0BEC5">Luu: UID, Bien so, Thoi gian</text>

                    <!-- Arrow ESP32 -> Server MQTT -->
                    <line x1="430" y1="140" x2="500" y2="105" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrow-purple)"/>
                    <text x="465" y="115" text-anchor="middle" font-size="8" fill="#7B1FA2">MQTT</text>

                    <!-- Arrow Desktop -> Server DB -->
                    <line x1="430" y1="70" x2="500" y2="140" stroke="#336791" stroke-width="2" marker-end="url(#arrow)"/>
                    <text x="475" y="95" text-anchor="middle" font-size="8" fill="#336791">SQL</text>

                    <!-- Barrier/Cổng -->
                    <rect x="700" y="100" width="100" height="80" rx="5" fill="#FF5722" stroke="#E64A19" stroke-width="2"/>
                    <text x="750" y="125" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">BARRIER</text>
                    <rect x="720" y="135" width="60" height="8" fill="#fff"/>
                    <text x="750" y="165" text-anchor="middle" font-size="9" fill="#FFCCBC">Mo cong</text>

                    <!-- Arrow Server -> ESP32 (response) -->
                    <path d="M575 190 L575 220 L360 220 L360 195" stroke="#2E7D32" stroke-width="2" fill="none" marker-end="url(#arrow-green)"/>
                    <text x="470" y="235" text-anchor="middle" font-size="8" fill="#2E7D32">MQTT Response: OK</text>

                    <!-- Arrow ESP32 -> Barrier -->
                    <line x1="430" y1="160" x2="700" y2="140" stroke="#FF5722" stroke-width="2" marker-end="url(#arrow)"/>
                    <text x="560" y="145" text-anchor="middle" font-size="8" fill="#E64A19">GPIO Signal</text>
                </g>

                <!-- Flowchart phía dưới -->
                <g transform="translate(20, 280)">
                    <text x="0" y="0" font-size="12" font-weight="bold" fill="#0066cc">Trinh tu xu ly:</text>

                    <!-- Step boxes -->
                    <rect x="0" y="20" width="120" height="40" rx="20" fill="#FFE082" stroke="#F57C00" stroke-width="2"/>
                    <text x="60" y="45" text-anchor="middle" font-size="10">1. Xe den</text>

                    <line x1="120" y1="40" x2="150" y2="40" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

                    <rect x="160" y="20" width="120" height="40" rx="5" fill="#333" stroke="#222" stroke-width="2"/>
                    <text x="220" y="45" text-anchor="middle" font-size="10" fill="#fff">2. Chup anh</text>

                    <line x1="280" y1="40" x2="310" y2="40" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

                    <rect x="320" y="20" width="120" height="40" rx="5" fill="#FF5722" stroke="#E64A19" stroke-width="2"/>
                    <text x="380" y="45" text-anchor="middle" font-size="10" fill="#fff">3. AI xu ly</text>

                    <line x1="440" y1="40" x2="470" y2="40" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

                    <rect x="480" y="20" width="120" height="40" rx="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                    <text x="540" y="45" text-anchor="middle" font-size="10" fill="#fff">4. Quet the</text>

                    <line x1="600" y1="40" x2="630" y2="40" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

                    <rect x="640" y="20" width="120" height="40" rx="5" fill="#1B5E20" stroke="#0D3610" stroke-width="2"/>
                    <text x="700" y="45" text-anchor="middle" font-size="10" fill="#fff">5. Gui MQTT</text>

                    <line x1="760" y1="40" x2="790" y2="40" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

                    <rect x="800" y="20" width="100" height="40" rx="5" fill="#336791" stroke="#1d4f6f" stroke-width="2"/>
                    <text x="850" y="45" text-anchor="middle" font-size="10" fill="#fff">6. Luu DB</text>

                    <line x1="900" y1="40" x2="930" y2="40" stroke="#333" stroke-width="2" marker-end="url(#arrow)"/>

                    <rect x="940" y="20" width="100" height="40" rx="5" fill="#FF5722" stroke="#E64A19" stroke-width="2"/>
                    <text x="990" y="45" text-anchor="middle" font-size="10" fill="#fff">7. Mo barrier</text>

                    <!-- Dữ liệu lưu -->
                    <text x="0" y="100" font-size="11" font-weight="bold" fill="#336791">Du lieu luu vao Database:</text>
                    <text x="0" y="120" font-size="10" fill="#333">• card_uid: Ma the RFID</text>
                    <text x="200" y="120" font-size="10" fill="#333">• plate_number: Bien so xe (tu AI)</text>
                    <text x="450" y="120" font-size="10" fill="#333">• entry_time: Thoi gian vao</text>
                    <text x="650" y="120" font-size="10" fill="#333">• entry_image: Anh chup</text>
                </g>
            </svg>
        </div>

        <!-- ==================== LUỒNG 2: XE RA ==================== -->
        <div class="section-title">2. Luong Xe Ra (Exit Flow)</div>
        <div class="flow-container">
            <svg width="100%" height="450" viewBox="0 0 1100 450">
                <defs>
                    <marker id="arrow2" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
                    </marker>
                </defs>

                <g transform="translate(20, 20)">
                    <!-- Xe ra -->
                    <rect x="0" y="30" width="80" height="50" rx="5" fill="#FFCDD2" stroke="#C62828" stroke-width="2"/>
                    <text x="40" y="60" text-anchor="middle" font-size="12" font-weight="bold">XE RA</text>

                    <line x1="80" y1="55" x2="120" y2="55" stroke="#333" stroke-width="2" marker-end="url(#arrow2)"/>

                    <!-- Camera 2 -->
                    <rect x="130" y="20" width="100" height="70" rx="5" fill="#333" stroke="#222" stroke-width="2"/>
                    <circle cx="180" cy="50" r="20" fill="#1a1a1a" stroke="#444" stroke-width="2"/>
                    <circle cx="180" cy="50" r="10" fill="#FF5722"/>
                    <text x="180" y="80" text-anchor="middle" font-size="9" fill="#fff">CAMERA #2</text>

                    <line x1="230" y1="55" x2="280" y2="55" stroke="#333" stroke-width="2" marker-end="url(#arrow2)"/>
                    <text x="255" y="48" text-anchor="middle" font-size="8" fill="#666">USB</text>

                    <!-- Desktop -->
                    <rect x="290" y="10" width="140" height="90" rx="5" fill="#2d5a8c" stroke="#1a3a5c" stroke-width="2"/>
                    <text x="360" y="35" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">DESKTOP</text>
                    <rect x="300" y="45" width="120" height="25" rx="3" fill="#FF5722"/>
                    <text x="360" y="62" text-anchor="middle" font-size="9" fill="#fff">YOLOv8 + EasyOCR</text>
                    <text x="360" y="88" text-anchor="middle" font-size="9" fill="#B3E5FC">So sanh bien so</text>

                    <!-- RFID #2 -->
                    <rect x="130" y="120" width="100" height="60" rx="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                    <circle cx="180" cy="145" r="15" fill="none" stroke="#FFC107" stroke-width="3"/>
                    <circle cx="180" cy="145" r="7" fill="#FFC107"/>
                    <text x="180" y="172" text-anchor="middle" font-size="9" fill="#fff">RFID RC522 #2</text>

                    <!-- Thẻ -->
                    <rect x="20" y="130" width="60" height="40" rx="5" fill="#fff" stroke="#1565C0" stroke-width="2"/>
                    <text x="50" y="155" text-anchor="middle" font-size="8" fill="#1565C0">THE RFID</text>

                    <line x1="80" y1="150" x2="130" y2="150" stroke="#1565C0" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrow-blue)"/>

                    <!-- ESP32 #1 -->
                    <rect x="290" y="115" width="140" height="70" rx="5" fill="#1B5E20" stroke="#0D3610" stroke-width="2"/>
                    <text x="360" y="140" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">ESP32-S3 #1</text>
                    <text x="360" y="158" text-anchor="middle" font-size="9" fill="#AED581">Doc UID</text>
                    <text x="360" y="173" text-anchor="middle" font-size="9" fill="#AED581">Gui MQTT exit</text>

                    <line x1="230" y1="150" x2="290" y2="150" stroke="#1565C0" stroke-width="2" marker-end="url(#arrow-blue)"/>
                    <text x="260" y="142" text-anchor="middle" font-size="8" fill="#1565C0">SPI</text>

                    <!-- Server -->
                    <rect x="500" y="30" width="180" height="170" rx="5" fill="#37474F" stroke="#263238" stroke-width="2"/>
                    <text x="590" y="55" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">LINUX SERVER</text>

                    <rect x="510" y="65" width="160" height="35" rx="3" fill="#9C27B0"/>
                    <text x="590" y="87" text-anchor="middle" font-size="10" fill="#fff">MQTT Broker</text>

                    <rect x="510" y="105" width="160" height="35" rx="3" fill="#336791"/>
                    <text x="590" y="127" text-anchor="middle" font-size="10" fill="#fff">PostgreSQL</text>

                    <rect x="510" y="145" width="160" height="45" rx="3" fill="#4CAF50"/>
                    <text x="590" y="165" text-anchor="middle" font-size="9" fill="#fff">Tinh phi gui xe</text>
                    <text x="590" y="180" text-anchor="middle" font-size="8" fill="#C8E6C9">3000 + (gio × 5000) VND</text>

                    <!-- Arrow to Server -->
                    <line x1="430" y1="150" x2="500" y2="100" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrow-purple)"/>
                    <text x="465" y="118" text-anchor="middle" font-size="8" fill="#7B1FA2">MQTT</text>

                    <line x1="430" y1="60" x2="500" y2="120" stroke="#336791" stroke-width="2" marker-end="url(#arrow2)"/>
                    <text x="475" y="80" text-anchor="middle" font-size="8" fill="#336791">SQL</text>

                    <!-- Decision: Đã thanh toán? -->
                    <polygon points="750,100 820,140 750,180 680,140" fill="#FFF9C4" stroke="#F9A825" stroke-width="2"/>
                    <text x="750" y="135" text-anchor="middle" font-size="9" font-weight="bold">Da thanh</text>
                    <text x="750" y="148" text-anchor="middle" font-size="9" font-weight="bold">toan?</text>

                    <!-- Yes -> Open barrier -->
                    <line x1="820" y1="140" x2="870" y2="140" stroke="#2E7D32" stroke-width="2" marker-end="url(#arrow-green)"/>
                    <text x="845" y="132" font-size="9" fill="#2E7D32">Co</text>

                    <rect x="880" y="110" width="100" height="60" rx="5" fill="#4CAF50" stroke="#2E7D32" stroke-width="2"/>
                    <text x="930" y="135" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">MO BARRIER</text>
                    <text x="930" y="155" text-anchor="middle" font-size="9" fill="#C8E6C9">Xe ra</text>

                    <!-- No -> Payment required -->
                    <line x1="750" y1="180" x2="750" y2="220" stroke="#C62828" stroke-width="2" marker-end="url(#arrow2)"/>
                    <text x="765" y="200" font-size="9" fill="#C62828">Chua</text>

                    <rect x="680" y="230" width="140" height="50" rx="5" fill="#FFCDD2" stroke="#C62828" stroke-width="2"/>
                    <text x="750" y="255" text-anchor="middle" font-size="10" font-weight="bold" fill="#C62828">YEU CAU</text>
                    <text x="750" y="270" text-anchor="middle" font-size="10" font-weight="bold" fill="#C62828">THANH TOAN</text>

                    <!-- Arrow to payment station -->
                    <line x1="680" y1="255" x2="600" y2="255" stroke="#7B1FA2" stroke-width="2" marker-end="url(#arrow-purple)"/>
                </g>

                <!-- Timeline -->
                <g transform="translate(20, 320)">
                    <text x="0" y="0" font-size="12" font-weight="bold" fill="#C62828">Trinh tu xu ly xe ra:</text>

                    <rect x="0" y="20" width="100" height="35" rx="5" fill="#FFCDD2" stroke="#C62828" stroke-width="2"/>
                    <text x="50" y="42" text-anchor="middle" font-size="9">1. Xe den cong</text>

                    <line x1="100" y1="37" x2="125" y2="37" stroke="#333" stroke-width="2" marker-end="url(#arrow2)"/>

                    <rect x="135" y="20" width="100" height="35" rx="5" fill="#333" stroke="#222" stroke-width="2"/>
                    <text x="185" y="42" text-anchor="middle" font-size="9" fill="#fff">2. Chup anh</text>

                    <line x1="235" y1="37" x2="260" y2="37" stroke="#333" stroke-width="2" marker-end="url(#arrow2)"/>

                    <rect x="270" y="20" width="100" height="35" rx="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                    <text x="320" y="42" text-anchor="middle" font-size="9" fill="#fff">3. Quet the</text>

                    <line x1="370" y1="37" x2="395" y2="37" stroke="#333" stroke-width="2" marker-end="url(#arrow2)"/>

                    <rect x="405" y="20" width="110" height="35" rx="5" fill="#336791" stroke="#1d4f6f" stroke-width="2"/>
                    <text x="460" y="42" text-anchor="middle" font-size="9" fill="#fff">4. Truy van DB</text>

                    <line x1="515" y1="37" x2="540" y2="37" stroke="#333" stroke-width="2" marker-end="url(#arrow2)"/>

                    <rect x="550" y="20" width="110" height="35" rx="5" fill="#4CAF50" stroke="#2E7D32" stroke-width="2"/>
                    <text x="605" y="42" text-anchor="middle" font-size="9" fill="#fff">5. Kiem tra TT</text>

                    <line x1="660" y1="37" x2="685" y2="37" stroke="#333" stroke-width="2" marker-end="url(#arrow2)"/>

                    <rect x="695" y="20" width="110" height="35" rx="5" fill="#FF5722" stroke="#E64A19" stroke-width="2"/>
                    <text x="750" y="42" text-anchor="middle" font-size="9" fill="#fff">6. Mo/Khong mo</text>

                    <!-- Ghi chú -->
                    <text x="0" y="85" font-size="10" fill="#333">* Neu chua thanh toan: Yeu cau qua tram thanh toan (RFID #3 + TFT)</text>
                    <text x="0" y="102" font-size="10" fill="#333">* So sanh bien so xe vao vs xe ra de dam bao dung xe</text>
                </g>
            </svg>
        </div>

        <!-- ==================== LUỒNG 3: THANH TOÁN ==================== -->
        <div class="section-title">3. Luong Thanh Toan (Payment Flow)</div>
        <div class="flow-container">
            <svg width="100%" height="480" viewBox="0 0 1100 480">
                <defs>
                    <marker id="arrow3" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#333"/>
                    </marker>
                </defs>

                <g transform="translate(20, 20)">
                    <!-- User với thẻ -->
                    <ellipse cx="50" cy="50" rx="40" ry="35" fill="#FFF9C4" stroke="#F9A825" stroke-width="2"/>
                    <text x="50" y="45" text-anchor="middle" font-size="10" font-weight="bold">CHU XE</text>
                    <text x="50" y="60" text-anchor="middle" font-size="9">(User)</text>

                    <line x1="90" y1="50" x2="140" y2="50" stroke="#333" stroke-width="2" marker-end="url(#arrow3)"/>
                    <text x="115" y="42" text-anchor="middle" font-size="8">Quet the</text>

                    <!-- RFID #3 -->
                    <rect x="150" y="20" width="100" height="60" rx="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                    <circle cx="200" cy="45" r="15" fill="none" stroke="#FFC107" stroke-width="3"/>
                    <circle cx="200" cy="45" r="7" fill="#FFC107"/>
                    <text x="200" y="72" text-anchor="middle" font-size="9" fill="#fff">RFID RC522 #3</text>

                    <!-- ESP32 #2 -->
                    <rect x="150" y="110" width="100" height="70" rx="5" fill="#1B5E20" stroke="#0D3610" stroke-width="2"/>
                    <text x="200" y="135" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">ESP32-S3 #2</text>
                    <text x="200" y="155" text-anchor="middle" font-size="9" fill="#AED581">Xu ly thanh toan</text>
                    <text x="200" y="170" text-anchor="middle" font-size="8" fill="#AED581">HTTP Client</text>

                    <!-- Arrow RFID -> ESP32 -->
                    <line x1="200" y1="80" x2="200" y2="110" stroke="#1565C0" stroke-width="2" marker-end="url(#arrow-blue)"/>
                    <text x="215" y="98" font-size="8" fill="#1565C0">SPI</text>

                    <!-- TFT Display -->
                    <rect x="280" y="110" width="120" height="70" rx="5" fill="#000080" stroke="#000" stroke-width="2"/>
                    <rect x="290" y="120" width="100" height="50" fill="#001a33"/>
                    <text x="340" y="140" text-anchor="middle" font-size="9" fill="#00FF00">So tien: 23,000d</text>
                    <text x="340" y="155" text-anchor="middle" font-size="8" fill="#FFFF00">Quet QR thanh toan</text>
                    <text x="340" y="190" text-anchor="middle" font-size="9" fill="#fff">TFT ST7735</text>

                    <!-- Arrow ESP32 -> TFT -->
                    <line x1="250" y1="145" x2="280" y2="145" stroke="#1565C0" stroke-width="2" marker-end="url(#arrow-blue)"/>
                    <text x="265" y="138" font-size="8" fill="#1565C0">SPI</text>

                    <!-- Server -->
                    <rect x="450" y="20" width="180" height="170" rx="5" fill="#37474F" stroke="#263238" stroke-width="2"/>
                    <text x="540" y="45" text-anchor="middle" font-size="11" font-weight="bold" fill="#fff">LINUX SERVER</text>

                    <rect x="460" y="55" width="160" height="35" rx="3" fill="#336791"/>
                    <text x="540" y="77" text-anchor="middle" font-size="10" fill="#fff">PostgreSQL</text>

                    <rect x="460" y="95" width="160" height="35" rx="3" fill="#4CAF50"/>
                    <text x="540" y="117" text-anchor="middle" font-size="10" fill="#fff">Web API (Flask)</text>

                    <rect x="460" y="135" width="160" height="45" rx="3" fill="#FF5722"/>
                    <text x="540" y="155" text-anchor="middle" font-size="9" fill="#fff">Tao ma VietQR</text>
                    <text x="540" y="170" text-anchor="middle" font-size="8" fill="#FFCCBC">SePay Integration</text>

                    <!-- Arrow ESP32 -> Server -->
                    <line x1="250" y1="145" x2="450" y2="115" stroke="#4CAF50" stroke-width="2" marker-end="url(#arrow-green)"/>
                    <text x="350" y="120" text-anchor="middle" font-size="8" fill="#2E7D32">HTTP GET /payment</text>

                    <!-- QR Code -->
                    <rect x="680" y="60" width="100" height="100" rx="5" fill="#fff" stroke="#333" stroke-width="2"/>
                    <rect x="695" y="75" width="70" height="70" fill="#333"/>
                    <rect x="705" y="85" width="15" height="15" fill="#fff"/>
                    <rect x="730" y="85" width="15" height="15" fill="#fff"/>
                    <rect x="705" y="115" width="15" height="15" fill="#fff"/>
                    <rect x="725" y="105" width="10" height="10" fill="#fff"/>
                    <text x="730" y="175" text-anchor="middle" font-size="10" font-weight="bold">VietQR</text>

                    <!-- Arrow Server -> QR -->
                    <line x1="620" y1="130" x2="680" y2="110" stroke="#333" stroke-width="2" marker-end="url(#arrow3)"/>

                    <!-- User scan QR -->
                    <rect x="830" y="60" width="100" height="100" rx="5" fill="#E3F2FD" stroke="#1565C0" stroke-width="2"/>
                    <rect x="855" y="75" width="50" height="70" rx="3" fill="#333"/>
                    <rect x="860" y="80" width="40" height="55" fill="#4a90d9"/>
                    <text x="880" y="175" text-anchor="middle" font-size="10" font-weight="bold" fill="#1565C0">Mobile Bank</text>

                    <line x1="780" y1="110" x2="830" y2="110" stroke="#1565C0" stroke-width="2" stroke-dasharray="5,3" marker-end="url(#arrow-blue)"/>
                    <text x="805" y="100" font-size="8" fill="#1565C0">Scan</text>

                    <!-- SePay Webhook -->
                    <rect x="680" y="200" width="130" height="50" rx="5" fill="#9C27B0" stroke="#7B1FA2" stroke-width="2"/>
                    <text x="745" y="225" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">SePay Webhook</text>
                    <text x="745" y="242" text-anchor="middle" font-size="8" fill="#E1BEE7">Callback: Success</text>

                    <!-- Arrow Bank -> SePay -->
                    <line x1="880" y1="160" x2="880" y2="225" stroke="#9C27B0" stroke-width="2"/>
                    <line x1="880" y1="225" x2="810" y2="225" stroke="#9C27B0" stroke-width="2" marker-end="url(#arrow-purple)"/>
                    <text x="860" y="195" font-size="8" fill="#7B1FA2">Payment</text>

                    <!-- Arrow SePay -> Server -->
                    <line x1="680" y1="225" x2="620" y2="175" stroke="#4CAF50" stroke-width="2" marker-end="url(#arrow-green)"/>
                    <text x="640" y="195" font-size="8" fill="#2E7D32">Webhook</text>

                    <!-- Update DB -->
                    <rect x="450" y="200" width="160" height="45" rx="5" fill="#4CAF50" stroke="#2E7D32" stroke-width="2"/>
                    <text x="530" y="220" text-anchor="middle" font-size="10" font-weight="bold" fill="#fff">CAP NHAT DB</text>
                    <text x="530" y="237" text-anchor="middle" font-size="9" fill="#C8E6C9">payment_status = PAID</text>

                    <!-- Arrow -->
                    <line x1="540" y1="190" x2="540" y2="200" stroke="#336791" stroke-width="2" marker-end="url(#arrow3)"/>

                    <!-- Notify ESP32 -->
                    <path d="M450 222 L350 222 L350 180 L250 180" stroke="#1B5E20" stroke-width="2" fill="none" marker-end="url(#arrow-green)"/>
                    <text x="300" y="212" font-size="8" fill="#1B5E20">MQTT: paid=true</text>

                    <!-- TFT Update -->
                    <rect x="280" y="200" width="120" height="50" rx="5" fill="#000080" stroke="#4CAF50" stroke-width="3"/>
                    <text x="340" y="225" text-anchor="middle" font-size="10" fill="#00FF00">THANH TOAN</text>
                    <text x="340" y="242" text-anchor="middle" font-size="10" fill="#00FF00">THANH CONG!</text>
                </g>

                <!-- Timeline -->
                <g transform="translate(20, 300)">
                    <text x="0" y="0" font-size="12" font-weight="bold" fill="#7B1FA2">Trinh tu thanh toan:</text>

                    <rect x="0" y="20" width="90" height="35" rx="5" fill="#2196F3" stroke="#1565C0" stroke-width="2"/>
                    <text x="45" y="42" text-anchor="middle" font-size="8" fill="#fff">1. Quet the</text>

                    <line x1="90" y1="37" x2="110" y2="37" stroke="#333" stroke-width="2" marker-end="url(#arrow3)"/>

                    <rect x="120" y="20" width="90" height="35" rx="5" fill="#1B5E20" stroke="#0D3610" stroke-width="2"/>
                    <text x="165" y="42" text-anchor="middle" font-size="8" fill="#fff">2. Lay UID</text>

                    <line x1="210" y1="37" x2="230" y2="37" stroke="#333" stroke-width="2" marker-end="url(#arrow3)"/>

                    <rect x="240" y="20" width="100" height="35" rx="5" fill="#4CAF50" stroke="#2E7D32" stroke-width="2"/>
                    <text x="290" y="42" text-anchor="middle" font-size="8" fill="#fff">3. GET /payment</text>

                    <line x1="340" y1="37" x2="360" y2="37" stroke="#333" stroke-width="2" marker-end="url(#arrow3)"/>

                    <rect x="370" y="20" width="90" height="35" rx="5" fill="#336791" stroke="#1d4f6f" stroke-width="2"/>
                    <text x="415" y="42" text-anchor="middle" font-size="8" fill="#fff">4. Tinh phi</text>

                    <line x1="460" y1="37" x2="480" y2="37" stroke="#333" stroke-width="2" marker-end="url(#arrow3)"/>

                    <rect x="490" y="20" width="90" height="35" rx="5" fill="#FF5722" stroke="#E64A19" stroke-width="2"/>
                    <text x="535" y="42" text-anchor="middle" font-size="8" fill="#fff">5. Tao QR</text>

                    <line x1="580" y1="37" x2="600" y2="37" stroke="#333" stroke-width="2" marker-end="url(#arrow3)"/>

                    <rect x="610" y="20" width="90" height="35" rx="5" fill="#E3F2FD" stroke="#1565C0" stroke-width="2"/>
                    <text x="655" y="42" text-anchor="middle" font-size="8" fill="#1565C0">6. User scan</text>

                    <line x1="700" y1="37" x2="720" y2="37" stroke="#333" stroke-width="2" marker-end="url(#arrow3)"/>

                    <rect x="730" y="20" width="90" height="35" rx="5" fill="#9C27B0" stroke="#7B1FA2" stroke-width="2"/>
                    <text x="775" y="42" text-anchor="middle" font-size="8" fill="#fff">7. Webhook</text>

                    <line x1="820" y1="37" x2="840" y2="37" stroke="#333" stroke-width="2" marker-end="url(#arrow3)"/>

                    <rect x="850" y="20" width="100" height="35" rx="5" fill="#4CAF50" stroke="#2E7D32" stroke-width="2"/>
                    <text x="900" y="42" text-anchor="middle" font-size="8" fill="#fff">8. Cap nhat DB</text>

                    <!-- Công thức tính phí -->
                    <rect x="0" y="80" width="400" height="50" rx="5" fill="#FFF9C4" stroke="#F9A825" stroke-width="2"/>
                    <text x="200" y="100" text-anchor="middle" font-size="11" font-weight="bold" fill="#F57F17">CONG THUC TINH PHI:</text>
                    <text x="200" y="118" text-anchor="middle" font-size="12" font-weight="bold" fill="#333">PHI = 3,000 + floor(phut/60) × 5,000 VND</text>
                </g>
            </svg>
        </div>

        <!-- Footer -->
        <div style="text-align: center; margin-top: 30px; padding: 15px; background: #f5f5f5; border-radius: 10px;">
            <p style="color: #666; font-size: 11px;">Smart Parking System - Hardware Flow Diagram</p>
            <p style="color: #999; font-size: 10px;">ESP32-S3 | RFID RC522 | Camera HD | TFT ST7735 | MQTT | PostgreSQL</p>
        </div>
    </div>
</body>
</html>
